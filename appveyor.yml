# This doesn't work, purely for the reason that AppVeyor doesn't support 64-bit guests.

version: 1.0.{build}

image:
  # Guarantees that we are using Windows Server 2016,
  # which (apparently) offers nested 64-bit virtualisation.
  - Visual Studio 2017

cache:
  - packer_cache
  - C:\ProgramData\chocolatey\bin
  - C:\ProgramData\chocolatey\lib

init:
  # Display RDP info in case we need to debug the build
  - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

install:
  - git submodule update --init --recursive
  - cinst packer
  - cinst virtualbox
  - refreshenv
  - set

build_script:
  - set PACKER_LOG=1
  - set PACKER_CACHE_DIR=%cd%\packer_cache
  - packer validate archlinux.json
  - packer build archlinux.json
